define(["./ArcType-f8a754c5","./BoundingRectangle-f7aac99a","./buildModuleUrl-8cce5713","./Cartesian4-b0ddc4ba","./Check-7b2a090c","./FeatureDetection-ab6f364c","./CoplanarPolygonGeometryLibrary-e0f93d68","./when-b60132fc","./GeometryAttribute-923c2729","./GeometryAttributes-252e9929","./PolygonGeometryLibrary-34d6c185","./GeometryPipeline-54076c24","./IndexDatatype-3565e02d","./Math-31e539c2","./PolygonPipeline-f2f37e26","./VertexFormat-6446fca0","./WebGLConstants-aba9fc67","./OrientedBoundingBox-a6c2fb0f","./Plane-5716a082","./EllipsoidRhumbLine-3ee4574a","./AttributeCompression-399750a1","./EncodedCartesian3-ac3717ed","./earcut-2.2.1-20c8012f"],(function(e,t,a,n,r,o,i,l,s,p,c,y,u,m,d,g,v,h,b,f,x,C,P){"use strict";var w=new n.Cartesian3,A=new t.BoundingRectangle,F=new a.Cartesian2,L=new a.Cartesian2,G=new n.Cartesian3,E=new n.Cartesian3,D=new n.Cartesian3,T=new n.Cartesian3,_=new n.Cartesian3,k=new n.Cartesian3,V=new s.Quaternion,R=new a.Matrix3,M=new a.Matrix3,H=new n.Cartesian3;function I(e,t,r,i,l,c,y,g){var v=e.positions,h=d.PolygonPipeline.triangulate(e.positions2D,e.holes);h.length<3&&(h=[0,1,2]);var b=u.IndexDatatype.createTypedArray(v.length,h.length);b.set(h);var f=R;if(0!==i){var x=s.Quaternion.fromAxisAngle(c,i,V);if(f=a.Matrix3.fromQuaternion(x,f),t.tangent||t.bitangent){x=s.Quaternion.fromAxisAngle(c,-i,V);var C=a.Matrix3.fromQuaternion(x,M);y=n.Cartesian3.normalize(a.Matrix3.multiplyByVector(C,y,y),y),t.bitangent&&(g=n.Cartesian3.normalize(n.Cartesian3.cross(c,y,g),g))}}else f=a.Matrix3.clone(a.Matrix3.IDENTITY,f);var P=L;t.st&&(P.x=r.x,P.y=r.y);for(var A=v.length,G=3*A,E=new Float64Array(G),D=t.normal?new Float32Array(G):void 0,T=t.tangent?new Float32Array(G):void 0,_=t.bitangent?new Float32Array(G):void 0,k=t.st?new Float32Array(2*A):void 0,H=0,I=0,B=0,O=0,z=0,S=0;S<A;S++){var N=v[S];if(E[H++]=N.x,E[H++]=N.y,E[H++]=N.z,t.st){var Q=l(a.Matrix3.multiplyByVector(f,N,w),F);a.Cartesian2.subtract(Q,P,Q);var U=m.Math3D.clamp(Q.x/r.width,0,1),j=m.Math3D.clamp(Q.y/r.height,0,1);k[z++]=U,k[z++]=j}t.normal&&(D[I++]=c.x,D[I++]=c.y,D[I++]=c.z),t.tangent&&(T[O++]=y.x,T[O++]=y.y,T[O++]=y.z),t.bitangent&&(_[B++]=g.x,_[B++]=g.y,_[B++]=g.z)}var Y=new p.GeometryAttributes;return t.position&&(Y.position=new s.GeometryAttribute({componentDatatype:o.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:E})),t.normal&&(Y.normal=new s.GeometryAttribute({componentDatatype:o.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:D})),t.tangent&&(Y.tangent=new s.GeometryAttribute({componentDatatype:o.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:T})),t.bitangent&&(Y.bitangent=new s.GeometryAttribute({componentDatatype:o.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:_})),t.st&&(Y.st=new s.GeometryAttribute({componentDatatype:o.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:k})),new s.Geometry({attributes:Y,indices:b,primitiveType:a.PrimitiveType.TRIANGLES})}function B(e){var t=(e=l.defaultValue(e,l.defaultValue.EMPTY_OBJECT)).polygonHierarchy,n=l.defaultValue(e.vertexFormat,g.VertexFormat.DEFAULT);this._vertexFormat=g.VertexFormat.clone(n),this._polygonHierarchy=t,this._stRotation=l.defaultValue(e.stRotation,0),this._ellipsoid=a.Ellipsoid.clone(l.defaultValue(e.ellipsoid,a.Ellipsoid.WGS84)),this._workerName="createCoplanarPolygonGeometry",this.packedLength=c.PolygonGeometryLibrary.computeHierarchyPackedLength(t)+g.VertexFormat.packedLength+a.Ellipsoid.packedLength+2}B.fromPositions=function(e){return new B({polygonHierarchy:{positions:(e=l.defaultValue(e,l.defaultValue.EMPTY_OBJECT)).positions},vertexFormat:e.vertexFormat,stRotation:e.stRotation,ellipsoid:e.ellipsoid})},B.pack=function(e,t,n){return n=l.defaultValue(n,0),n=c.PolygonGeometryLibrary.packPolygonHierarchy(e._polygonHierarchy,t,n),a.Ellipsoid.pack(e._ellipsoid,t,n),n+=a.Ellipsoid.packedLength,g.VertexFormat.pack(e._vertexFormat,t,n),n+=g.VertexFormat.packedLength,t[n++]=e._stRotation,t[n]=e.packedLength,t};var O=a.Ellipsoid.clone(a.Ellipsoid.UNIT_SPHERE),z=new g.VertexFormat,S={polygonHierarchy:{}};return B.unpack=function(e,t,n){t=l.defaultValue(t,0);var r=c.PolygonGeometryLibrary.unpackPolygonHierarchy(e,t);t=r.startingIndex,delete r.startingIndex;var o=a.Ellipsoid.unpack(e,t,O);t+=a.Ellipsoid.packedLength;var i=g.VertexFormat.unpack(e,t,z);t+=g.VertexFormat.packedLength;var s=e[t++],p=e[t];return l.defined(n)||(n=new B(S)),n._polygonHierarchy=r,n._ellipsoid=a.Ellipsoid.clone(o,n._ellipsoid),n._vertexFormat=g.VertexFormat.clone(i,n._vertexFormat),n._stRotation=s,n.packedLength=p,n},B.createGeometry=function(t){var r=t._vertexFormat,o=t._polygonHierarchy,l=t._stRotation,p=o.positions;if(!((p=e.arrayRemoveDuplicates(p,n.Cartesian3.equalsEpsilon,!0)).length<3)){var d=G,g=E,v=D,h=_,b=k;if(i.CoplanarPolygonGeometryLibrary.computeProjectTo2DArguments(p,T,h,b)){if(d=n.Cartesian3.cross(h,b,d),d=n.Cartesian3.normalize(d,d),!n.Cartesian3.equalsEpsilon(T,n.Cartesian3.ZERO,m.Math3D.EPSILON6)){var f=t._ellipsoid.geodeticSurfaceNormal(T,H);n.Cartesian3.dot(d,f)<0&&(d=n.Cartesian3.negate(d,d),h=n.Cartesian3.negate(h,h))}var x=i.CoplanarPolygonGeometryLibrary.createProjectPointsTo2DFunction(T,h,b),C=i.CoplanarPolygonGeometryLibrary.createProjectPointTo2DFunction(T,h,b);r.tangent&&(g=n.Cartesian3.clone(h,g)),r.bitangent&&(v=n.Cartesian3.clone(b,v));var P=c.PolygonGeometryLibrary.polygonsFromHierarchy(o,x,!1),w=P.hierarchy,F=P.polygons;if(0!==w.length){p=w[0].outerRing;for(var L=a.BoundingSphere.fromPoints(p),V=c.PolygonGeometryLibrary.computeBoundingRectangle(d,C,p,l,A),R=[],M=0;M<F.length;M++){var B=new c.GeometryInstance({geometry:I(F[M],r,V,l,C,d,g,v)});R.push(B)}var O=y.GeometryPipeline.combineInstances(R)[0];O.attributes.position.values=new Float64Array(O.attributes.position.values),O.indices=u.IndexDatatype.createTypedArray(O.attributes.position.values.length/3,O.indices);var z=O.attributes;return r.position||delete z.position,new s.Geometry({attributes:z,indices:O.indices,primitiveType:O.primitiveType,boundingSphere:L})}}}},function(e,t){return l.defined(t)&&(e=B.unpack(e,t)),B.createGeometry(e)}}));
