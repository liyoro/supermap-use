define(["./AttributeCompression-399750a1","./PolygonPipeline-f2f37e26","./buildModuleUrl-8cce5713","./Cartesian4-b0ddc4ba","./when-b60132fc","./TerrainEncoding-0e08edec","./IndexDatatype-3565e02d","./Math-31e539c2","./OrientedBoundingBox-a6c2fb0f","./Check-7b2a090c","./GeometryAttribute-923c2729","./WebMercatorProjection-6d3eefcc","./createTaskProcessorWorker","./Plane-5716a082","./earcut-2.2.1-20c8012f","./FeatureDetection-ab6f364c","./WebGLConstants-aba9fc67","./EllipsoidRhumbLine-3ee4574a"],(function(e,t,r,n,i,o,a,s,d,c,h,u,l,I,g,m,f,T){"use strict";function p(){c.DeveloperError.throwInstantiationError()}Object.defineProperties(p.prototype,{errorEvent:{get:c.DeveloperError.throwInstantiationError},credit:{get:c.DeveloperError.throwInstantiationError},tilingScheme:{get:c.DeveloperError.throwInstantiationError},ready:{get:c.DeveloperError.throwInstantiationError},readyPromise:{get:c.DeveloperError.throwInstantiationError},hasWaterMask:{get:c.DeveloperError.throwInstantiationError},hasVertexNormals:{get:c.DeveloperError.throwInstantiationError},availability:{get:c.DeveloperError.throwInstantiationError}});var v=[];p.getRegularGridIndices=function(e,t){var r=v[e];i.defined(r)||(v[e]=r=[]);var n=r[t];return i.defined(n)||N(e,t,n=e*t<s.Math3D.SIXTY_FOUR_KILOBYTES?r[t]=new Uint16Array((e-1)*(t-1)*6+3*(e+t-2)):r[t]=new Uint32Array((e-1)*(t-1)*6+3*(e+t-2)),0),n},p.getRegularGridIndicesForReproject=function(e,t){var r=v[e];i.defined(r)||(v[e]=r=[]);var n=r[t];return i.defined(n)||N(e,t,n=e*t<s.Math3D.SIXTY_FOUR_KILOBYTES?r[t]=new Uint16Array((e-1)*(t-1)*6):r[t]=new Uint32Array((e-1)*(t-1)*6),0),n};var E=[];p.getRegularGridIndicesAndEdgeIndices=function(e,t){var r=E[e];i.defined(r)||(E[e]=r=[]);var n=r[t];if(!i.defined(n)){var o=p.getRegularGridIndices(e,t),a=w(e,t),s=a.westIndicesSouthToNorth,d=a.southIndicesEastToWest,c=a.eastIndicesNorthToSouth,h=a.northIndicesWestToEast;n=r[t]={indices:o,westIndicesSouthToNorth:s,southIndicesEastToWest:d,eastIndicesNorthToSouth:c,northIndicesWestToEast:h}}return n};var y=[];function w(e,t){var r,n=new Array(t),i=new Array(e),o=new Array(t),a=new Array(e);for(r=0;r<e;++r)a[r]=r,i[r]=e*t-1-r;for(r=0;r<t;++r)o[r]=(r+1)*e-1,n[r]=(t-r-1)*e;return{westIndicesSouthToNorth:n,southIndicesEastToWest:i,eastIndicesNorthToSouth:o,northIndicesWestToEast:a}}function N(e,t,r,n){for(var i=0,o=0;o<t-1;++o){for(var a=0;a<e-1;++a){var s=i,d=s+e,c=d+1,h=s+1;r[n++]=s,r[n++]=d,r[n++]=h,r[n++]=h,r[n++]=d,r[n++]=c,++i}++i}var u=(t-1)/2,l=(e-1)/2;i=0;for(a=0;a<l;a++)r[n++]=i,r[n++]=i+1,r[n++]=i+2,i+=2;i=e*(t-1);for(a=0;a<l;a++)r[n++]=i+1,r[n++]=i,r[n++]=i+2,i+=2;i=0;for(a=0;a<u;a++)r[n++]=i+e,r[n++]=i,r[n++]=i+2*e,i+=2*e;i=e-1;for(a=0;a<u;a++)r[n++]=i,r[n++]=i+e,r[n++]=i+2*e,i+=2*e}function x(e,t,r,n,o){for(var a=i.defined(o),s=e[0],d=e.length,c=1;c<d;++c){var h=e[c];!a||o[s+"_"+h]?(r[n++]=s,r[n++]=h,r[n++]=t,r[n++]=t,r[n++]=h,r[n++]=t+1,s=h,++t):(s=h,++t)}return n}p.getRegularGridAndSkirtIndicesAndEdgeIndices=function(e,t){var r=y[e];i.defined(r)||(y[e]=r=[]);var n=r[t];if(!i.defined(n)){var o=e*t,s=(e-1)*(t-1)*6,d=2*e+2*t,c=o+d,h=3*(e+t-2),u=s+6*Math.max(0,d-4)+h,l=w(e,t),I=l.westIndicesSouthToNorth,g=l.southIndicesEastToWest,m=l.eastIndicesNorthToSouth,f=l.northIndicesWestToEast,T=a.IndexDatatype.createTypedArray(c,u);N(e,t,T,0),p.addSkirtIndices(I,g,m,f,o,T,s+h),n=r[t]={indices:T,westIndicesSouthToNorth:I,southIndicesEastToWest:g,eastIndicesNorthToSouth:m,northIndicesWestToEast:f,indexCountWithoutSkirts:s}}return n},p.addSkirtIndices=function(e,t,r,n,i,o,a,s){var d=i;a=x(e,d,o,a,s),a=x(t,d+=e.length,o,a,s),a=x(r,d+=t.length,o,a,s),x(n,d+=r.length,o,a,s)},p.heightmapTerrainQuality=.25,p.getEstimatedLevelZeroGeometricErrorForAHeightmap=function(e,t,r){return 2*e.maximumRadius*Math.PI*p.heightmapTerrainQuality/(t*r)},p.prototype.requestTileGeometry=c.DeveloperError.throwInstantiationError,p.prototype.getLevelMaximumGeometricError=c.DeveloperError.throwInstantiationError,p.prototype.getTileDataAvailable=c.DeveloperError.throwInstantiationError,p.prototype.loadTileDataAvailability=c.DeveloperError.throwInstantiationError;var M=32767,b=new n.Cartesian3,A=new n.Cartesian3,S=new n.Cartesian3,C=new n.Cartographic,D=new r.Cartesian2,P=new n.Cartesian3,W=new r.Matrix4,_=new r.Matrix4;function F(e,t,i,o,a,d,c,h,u){var l=Number.POSITIVE_INFINITY,I=a.north,g=a.south,m=a.east,f=a.west;m<f&&(m+=s.Math3D.TWO_PI);for(var T=e.length,p=0;p<T;++p){var v=e[p],E=i[v],y=o[v];C.longitude=s.Math3D.lerp(f,m,y.x),C.latitude=s.Math3D.lerp(g,I,y.y),C.height=E-t;var w=d.cartographicToCartesian(C,b);r.Matrix4.multiplyByPoint(c,w,w),n.Cartesian3.minimumByComponent(w,h,h),n.Cartesian3.maximumByComponent(w,u,u),l=Math.min(l,C.height)}return l}function B(t,o,a,d,c,l,I,g,m,f,T,p,v,E,y){var w=i.defined(I),N=m.north,x=m.south,M=m.east,A=m.west;M<A&&(M+=s.Math3D.TWO_PI);for(var S=a.length,F=0;F<S;++F){var B=a[F],k=c[B],V=l[B];C.longitude=s.Math3D.lerp(A,M,V.x)+E,C.latitude=s.Math3D.lerp(x,N,V.y)+y,C.height=k-f;var O,G=g.cartographicToCartesian(C,b);if(w){var Y=2*B;if(D.x=I[Y],D.y=I[Y+1],1!==T){var H=e.AttributeCompression.octDecode(D.x,D.y,P),R=h.Transforms.eastNorthUpToFixedFrame(b,g,_),U=r.Matrix4.inverseTransformation(R,W);r.Matrix4.multiplyByPointAsVector(U,H,H),H.z*=T,n.Cartesian3.normalize(H,H),r.Matrix4.multiplyByPointAsVector(R,H,H),n.Cartesian3.normalize(H,H),e.AttributeCompression.octEncode(H,D)}}d.hasWebMercatorT&&(O=(u.WebMercatorProjection.geodeticLatitudeToMercatorAngle(C.latitude)-p)*v),o=d.encode(t,o,G,V,C.height,D,O)}}function k(e,t){var r;return"function"==typeof e.slice&&"function"!=typeof(r=e.slice()).sort&&(r=void 0),i.defined(r)||(r=Array.prototype.slice.call(e)),r.sort(t),r}return l((function(c,l){var I,g,m=c.quantizedVertices,f=m.length/3,T=c.octEncodedNormals,v=c.westIndices.length+c.eastIndices.length+c.southIndices.length+c.northIndices.length,E=c.includeWebMercatorT,y=r.Rectangle.clone(c.rectangle),w=y.west,N=y.south,x=y.east,V=y.north,O=r.Ellipsoid.clone(c.ellipsoid),G=c.exaggeration,Y=c.minimumHeight*G,H=c.maximumHeight*G,R=c.relativeToCenter,U=h.Transforms.eastNorthUpToFixedFrame(R,O),z=r.Matrix4.inverseTransformation(U,new r.Matrix4);E&&(I=u.WebMercatorProjection.geodeticLatitudeToMercatorAngle(N),g=1/(u.WebMercatorProjection.geodeticLatitudeToMercatorAngle(V)-I));var L=m.subarray(0,f),j=m.subarray(f,2*f),q=m.subarray(2*f,3*f),K=i.defined(T),Q=new Array(f),X=new Array(f),Z=new Array(f),J=E?new Array(f):[],$=A;$.x=Number.POSITIVE_INFINITY,$.y=Number.POSITIVE_INFINITY,$.z=Number.POSITIVE_INFINITY;var ee=S;ee.x=Number.NEGATIVE_INFINITY,ee.y=Number.NEGATIVE_INFINITY,ee.z=Number.NEGATIVE_INFINITY;for(var te=Number.POSITIVE_INFINITY,re=Number.NEGATIVE_INFINITY,ne=Number.POSITIVE_INFINITY,ie=Number.NEGATIVE_INFINITY,oe=0;oe<f;++oe){var ae=L[oe],se=j[oe],de=ae/M,ce=se/M,he=s.Math3D.lerp(Y,H,q[oe]/M);C.longitude=s.Math3D.lerp(w,x,de),C.latitude=s.Math3D.lerp(N,V,ce),C.height=he,te=Math.min(C.longitude,te),re=Math.max(C.longitude,re),ne=Math.min(C.latitude,ne),ie=Math.max(C.latitude,ie);var ue=O.cartographicToCartesian(C);Q[oe]=new r.Cartesian2(de,ce),X[oe]=he,Z[oe]=ue,E&&(J[oe]=(u.WebMercatorProjection.geodeticLatitudeToMercatorAngle(C.latitude)-I)*g),r.Matrix4.multiplyByPoint(z,ue,b),n.Cartesian3.minimumByComponent(b,$,$),n.Cartesian3.maximumByComponent(b,ee,ee)}var le,Ie,ge,me=k(c.westIndices,(function(e,t){return Q[e].y-Q[t].y})),fe=k(c.eastIndices,(function(e,t){return Q[t].y-Q[e].y})),Te=k(c.southIndices,(function(e,t){return Q[t].x-Q[e].x})),pe=k(c.northIndices,(function(e,t){return Q[e].x-Q[t].x}));Ie=r.BoundingSphere.fromPoints(Z),le=d.OrientedBoundingBox.fromRectangle(y,Y,H,O),(1!==G||Y<0)&&(ge=new o.EllipsoidalOccluder(O).computeHorizonCullingPointPossiblyUnderEllipsoid(R,Z,Y));var ve=Y;ve=Math.min(ve,F(c.westIndices,c.westSkirtHeight,X,Q,y,O,z,$,ee)),ve=Math.min(ve,F(c.southIndices,c.southSkirtHeight,X,Q,y,O,z,$,ee)),ve=Math.min(ve,F(c.eastIndices,c.eastSkirtHeight,X,Q,y,O,z,$,ee)),ve=Math.min(ve,F(c.northIndices,c.northSkirtHeight,X,Q,y,O,z,$,ee));for(var Ee=new t.AxisAlignedBoundingBox($,ee,R),ye=new o.TerrainEncoding(Ee,ve,H,U,K,E),we=ye.getStride(),Ne=new Float32Array(f*we+v*we),xe=0,Me=0;Me<f;++Me){if(K){var be=2*Me;if(D.x=T[be],D.y=T[be+1],1!==G){var Ae=e.AttributeCompression.octDecode(D.x,D.y,P),Se=h.Transforms.eastNorthUpToFixedFrame(Z[Me],O,_),Ce=r.Matrix4.inverseTransformation(Se,W);r.Matrix4.multiplyByPointAsVector(Ce,Ae,Ae),Ae.z*=G,n.Cartesian3.normalize(Ae,Ae),r.Matrix4.multiplyByPointAsVector(Se,Ae,Ae),n.Cartesian3.normalize(Ae,Ae),e.AttributeCompression.octEncode(Ae,D)}}xe=ye.encode(Ne,xe,Z[Me],Q[Me],X[Me],D,J[Me])}var De=Math.max(0,2*(v-4)),Pe=c.indices.length+3*De,We=a.IndexDatatype.createTypedArray(f+v,Pe);We.set(c.indices,0);var _e=1e-4,Fe=(re-te)*_e,Be=(ie-ne)*_e,ke=-Fe,Ve=Fe,Oe=Be,Ge=-Be,Ye=f*we;B(Ne,Ye,me,ye,X,Q,T,O,y,c.westSkirtHeight,G,I,g,ke,0),B(Ne,Ye+=c.westIndices.length*we,Te,ye,X,Q,T,O,y,c.southSkirtHeight,G,I,g,0,Ge),B(Ne,Ye+=c.southIndices.length*we,fe,ye,X,Q,T,O,y,c.eastSkirtHeight,G,I,g,Ve,0),B(Ne,Ye+=c.eastIndices.length*we,pe,ye,X,Q,T,O,y,c.northSkirtHeight,G,I,g,0,Oe);var He=function(e,t,r,n){if(n<12)return;for(var i={},o=e.length,a=0;a<o;a+=3){var s=e[a],d=e[a+1],c=e[a+2];(t[s]===M&&t[d]===M||0===t[s]&&0===t[d]||r[s]===M&&r[d]===M||0===r[s]&&0===r[d])&&(i[s+"_"+d]=1,i[d+"_"+s]=1),(t[d]===M&&t[c]===M||0===t[d]&&0===t[c]||r[d]===M&&r[c]===M||0===r[d]&&0===r[c])&&(i[d+"_"+c]=1,i[c+"_"+d]=1),(t[c]===M&&t[s]===M||0===t[c]&&0===t[s]||r[c]===M&&r[s]===M||0===r[c]&&0===r[s])&&(i[c+"_"+s]=1,i[s+"_"+c]=1)}return i}(c.indices,L,j,c.level);return p.addSkirtIndices(me,Te,fe,pe,f,We,c.indices.length,He),l.push(Ne.buffer,We.buffer),{vertices:Ne.buffer,indices:We.buffer,westIndicesSouthToNorth:me,southIndicesEastToWest:Te,eastIndicesNorthToSouth:fe,northIndicesWestToEast:pe,vertexStride:we,center:R,minimumHeight:Y,maximumHeight:H,boundingSphere:Ie,orientedBoundingBox:le,occludeePointInScaledSpace:ge,encoding:ye,indexCountWithoutSkirts:c.indices.length}}))}));
